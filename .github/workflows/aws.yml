name: Deploy to Amazon EC2

on:
  push:
    branches: [ "develop" ]

jobs:
  deploy:
    name: Deploy
    runs-on: ubuntu-latest

    steps:
    - name: checkout
      uses: actions/checkout@v3

    - name: build
      uses: isbang/compose-action@v1.5.1
      with:
        compose-file: "./docker-compose.yaml"
      env:
        POSTGRES_USER: "${{ secrets.POSTGRES_USER }}"
        POSTGRES_PASSWORD: "${{ secrets.POSTGRES_PASSWORD }}"
        POSTGRES_HOST: "${{ secrets.POSTGRES_HOST }}"
        POSTGRES_PORT: "${{ secrets.POSTGRES_PORT }}"
        POSTGRES_DB: "${{ secrets.POSTGRES_DB }}"
        
    # - name: build
    #   uses: burnett01/rsync-deployments@5.1
    #   with:
    #     switches: -avzr --delete
    #     path: ./*
    #     remote_path: /home/ubuntu/code
    #     remote_host: ec2-3-68-94-147.eu-central-1.compute.amazonaws.com
    #     remote_user: ubuntu
    #     remote_key: "${{ secrets.AMAZON_SSH }}"